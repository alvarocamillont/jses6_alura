{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["Negociacao","ListaNegociacoes","Mensagem","Bind","DateHelper","NegociacoesView","MensagemView","NegociacaoService","NegociacaoController","$","document","querySelector","bind","_ordemAtual","_inputData","_inputQuantidade","_inputValor","_listaNegociacoes","_mensagem","_service","_init","lista","then","negociacoes","forEach","adiciona","dado","catch","texto","erro","setInterval","importaNegociacoes","event","preventDefault","negociacao","_criaNegociacao","cadastra","mensagem","_limpaFormulario","textoParaData","value","parseInt","parseFloat","focus","apaga","esvazia","importa","coluna","inverteOrdem","ordena","a","b","negociacaoController","currentInstance"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import {Negociacao} from '../models/Negociacao.js'\r\nimport {ListaNegociacoes} from '../models/ListaNegociacao'\r\nimport {Mensagem} from '../models/Mensagem.js'\r\n\r\nimport {Bind} from '../helpers/Bind.js'\r\nimport {DateHelper} from '../helpers/DateHelper.js'\r\nimport {NegociacoesView} from '../views/NegociacoesView.js'\r\nimport {MensagemView} from '../views/Mensagem.js'\r\nimport {NegociacaoService} from '../services/NegociacaoService.js'\r\nclass NegociacaoController {\r\n  constructor () {\r\n    let $ = document.querySelector.bind(document)\r\n    this._ordemAtual = ''\r\n    this._inputData = $('#data')\r\n    this._inputQuantidade = $('#quantidade')\r\n    this._inputValor = $('#valor')\r\n\r\n    this._listaNegociacoes = new Bind(\r\n                new ListaNegociacoes(),\r\n                new NegociacoesView($('#negociacoesView')),\r\n                'adiciona', 'esvazia', 'ordena', 'inverteOrdem')\r\n\r\n    this._mensagem = new Bind(\r\n        new Mensagem(),\r\n        new MensagemView($('#mensagemView')),\r\n        'texto')\r\n\r\n    this._ordemAtual = ''\r\n    this._service = new NegociacaoService()\r\n    this._init()\r\n  }\r\n\r\n  _init () {\r\n    this._service\r\n        .lista()\r\n        .then(negociacoes =>\r\n            negociacoes.forEach(dado =>\r\n                this._listaNegociacoes.adiciona(dado)))\r\n        .catch(erro => this._mensagem.texto = erro)\r\n\r\n    setInterval(() => {\r\n      this.importaNegociacoes()\r\n    }, 3000)\r\n  }\r\n\r\n  adiciona (event) {\r\n    event.preventDefault()\r\n\r\n    let negociacao = this._criaNegociacao()\r\n\r\n    this._service\r\n            .cadastra(negociacao)\r\n            .then(mensagem => {\r\n              this._listaNegociacoes.adiciona(negociacao)\r\n              this._mensagem.texto = mensagem\r\n              this._limpaFormulario()\r\n            }).catch(erro => this._mensagem.texto = erro)\r\n  }\r\n\r\n  _criaNegociacao () {\r\n    return new Negociacao(\r\n       DateHelper.textoParaData(this._inputData.value),\r\n       parseInt(this._inputQuantidade.value),\r\n       parseFloat(this._inputValor.value))\r\n  }\r\n\r\n  _limpaFormulario () {\r\n    this._inputData.value = ''\r\n    this._inputQuantidade.value = 1\r\n    this._inputValor.value = 0.0\r\n\r\n    this._inputData.focus()\r\n  }\r\n\r\n  apagar () {\r\n    this._service\r\n        .apaga()\r\n        .then(mensagem => {\r\n          this._mensagem.texto = mensagem\r\n          this._listaNegociacoes.esvazia()\r\n        })\r\n        .catch(erro => this._mensagem.texto = erro)\r\n  }\r\n\r\n  importaNegociacoes () {\r\n    this._service\r\n        .importa(this._listaNegociacoes.negociacoes)\r\n        .then(negociacoes => negociacoes.forEach(negociacao => {\r\n          this._listaNegociacoes.adiciona(negociacao)\r\n          this._mensagem.texto = 'Negociações do período importadas'\r\n        }))\r\n        .catch(erro => this._mensagem.texto = erro)\r\n  }\r\n\r\n  ordena (coluna) {\r\n    if (this._ordemAtual === coluna) {\r\n      this._listaNegociacoes.inverteOrdem()\r\n    } else {\r\n      this._listaNegociacoes.ordena((a, b) => a[coluna] - b[coluna])\r\n    }\r\n    this._ordemAtual = coluna\r\n  }\r\n}\r\n\r\nlet negociacaoController = new NegociacaoController()\r\nexport function currentInstance () {\r\n  return negociacaoController\r\n}\r\n"]}